<?xml version="1.0" encoding="UTF-8"?>

<?import javafx.geometry.Insets?>
<?import javafx.scene.control.*?>
<?import javafx.scene.layout.*?>
<?import org.kordamp.ikonli.javafx.FontIcon?>

<VBox xmlns:fx="http://javafx.com/fxml/1"
      fx:controller="com.sgpa.controller.PromotionController"
      spacing="20" styleClass="view-root">
    <padding>
        <Insets top="20" right="20" bottom="20" left="20"/>
    </padding>

    <!-- Barre d'outils -->
    <HBox alignment="CENTER_LEFT" spacing="15" styleClass="toolbar">
        <Label text="Filtre:" styleClass="toolbar-label"/>
        <ComboBox fx:id="comboFiltre" promptText="Toutes" prefWidth="150"/>

        <Region HBox.hgrow="ALWAYS"/>

        <Button text="Nouvelle Promotion" onAction="#handleNouvelle" styleClass="action-button, primary">
            <graphic><FontIcon iconLiteral="fas-plus"/></graphic>
        </Button>
        <Button text="Actualiser" onAction="#handleRefresh" styleClass="action-button">
            <graphic><FontIcon iconLiteral="fas-sync-alt"/></graphic>
        </Button>
    </HBox>

    <!-- Statistiques resume -->
    <HBox alignment="CENTER_LEFT" spacing="20" styleClass="stats-bar">
        <HBox alignment="CENTER" spacing="5" styleClass="stat-badge">
            <FontIcon iconLiteral="fas-tags"/>
            <Label fx:id="lblTotal" text="0 promotion(s)"/>
        </HBox>
        <HBox alignment="CENTER" spacing="5" styleClass="stat-badge, success">
            <FontIcon iconLiteral="fas-check-circle"/>
            <Label fx:id="lblActives" text="0 active(s)"/>
        </HBox>
        <HBox alignment="CENTER" spacing="5" styleClass="stat-badge, warning">
            <FontIcon iconLiteral="fas-clock"/>
            <Label fx:id="lblFutures" text="0 future(s)"/>
        </HBox>
        <HBox alignment="CENTER" spacing="5" styleClass="stat-badge, danger">
            <FontIcon iconLiteral="fas-times-circle"/>
            <Label fx:id="lblExpirees" text="0 expiree(s)"/>
        </HBox>
    </HBox>

    <!-- Contenu principal -->
    <SplitPane dividerPositions="0.55" VBox.vgrow="ALWAYS">
        <!-- Table des promotions -->
        <VBox spacing="10" styleClass="panel">
            <Label text="Liste des Promotions" styleClass="panel-title"/>
            <TextField fx:id="txtRecherche" promptText="Rechercher une promotion..." styleClass="search-field"/>
            <TableView fx:id="tablePromotions" VBox.vgrow="ALWAYS" styleClass="data-table">
                <columns>
                    <TableColumn fx:id="colCode" text="Code" prefWidth="80"/>
                    <TableColumn fx:id="colNom" text="Nom" prefWidth="150"/>
                    <TableColumn fx:id="colType" text="Type" prefWidth="100"/>
                    <TableColumn fx:id="colValeur" text="Valeur" prefWidth="80"/>
                    <TableColumn fx:id="colDebut" text="Debut" prefWidth="90"/>
                    <TableColumn fx:id="colFin" text="Fin" prefWidth="90"/>
                    <TableColumn fx:id="colStatut" text="Statut" prefWidth="80"/>
                </columns>
                <placeholder><Label text="Aucune promotion"/></placeholder>
            </TableView>
        </VBox>

        <!-- Formulaire d'edition -->
        <VBox spacing="15" styleClass="panel">
            <Label fx:id="lblFormTitre" text="Nouvelle Promotion" styleClass="panel-title"/>

            <ScrollPane fitToWidth="true" VBox.vgrow="ALWAYS">
                <VBox spacing="15">
                    <padding>
                        <Insets top="10" right="10" bottom="10" left="10"/>
                    </padding>

                    <!-- Code promo -->
                    <VBox spacing="5">
                        <Label text="Code promotionnel (optionnel):" styleClass="form-label"/>
                        <TextField fx:id="txtCode" promptText="Ex: PROMO20"/>
                    </VBox>

                    <!-- Nom -->
                    <VBox spacing="5">
                        <Label text="Nom de la promotion *:" styleClass="form-label"/>
                        <TextField fx:id="txtNom" promptText="Ex: Soldes d'ete -20%"/>
                    </VBox>

                    <!-- Description -->
                    <VBox spacing="5">
                        <Label text="Description:" styleClass="form-label"/>
                        <TextArea fx:id="txtDescription" promptText="Description detaillee..." prefRowCount="2"/>
                    </VBox>

                    <!-- Type de promotion -->
                    <VBox spacing="5">
                        <Label text="Type de promotion *:" styleClass="form-label"/>
                        <ComboBox fx:id="comboType" promptText="Selectionnez un type" maxWidth="Infinity"/>
                    </VBox>

                    <!-- Valeur -->
                    <HBox spacing="15">
                        <VBox spacing="5" HBox.hgrow="ALWAYS">
                            <Label text="Valeur *:" styleClass="form-label"/>
                            <TextField fx:id="txtValeur" promptText="Ex: 20"/>
                        </VBox>
                        <VBox spacing="5">
                            <Label text="Unite:" styleClass="form-label"/>
                            <Label fx:id="lblUnite" text="%" styleClass="form-value"/>
                        </VBox>
                    </HBox>

                    <!-- Quantites pour offre groupee -->
                    <HBox fx:id="hboxQuantites" spacing="15" visible="false" managed="false">
                        <VBox spacing="5" HBox.hgrow="ALWAYS">
                            <Label text="Quantite requise:" styleClass="form-label"/>
                            <Spinner fx:id="spinnerQteRequise" min="1" max="100" initialValue="2" editable="true"/>
                        </VBox>
                        <VBox spacing="5" HBox.hgrow="ALWAYS">
                            <Label text="Quantite offerte:" styleClass="form-label"/>
                            <Spinner fx:id="spinnerQteOfferte" min="1" max="100" initialValue="1" editable="true"/>
                        </VBox>
                    </HBox>

                    <!-- Dates -->
                    <HBox spacing="15">
                        <VBox spacing="5" HBox.hgrow="ALWAYS">
                            <Label text="Date de debut *:" styleClass="form-label"/>
                            <DatePicker fx:id="dateDebut" maxWidth="Infinity"/>
                        </VBox>
                        <VBox spacing="5" HBox.hgrow="ALWAYS">
                            <Label text="Date de fin *:" styleClass="form-label"/>
                            <DatePicker fx:id="dateFin" maxWidth="Infinity"/>
                        </VBox>
                    </HBox>

                    <!-- Options -->
                    <VBox spacing="5">
                        <Label text="Options:" styleClass="form-label"/>
                        <CheckBox fx:id="checkActif" text="Promotion active" selected="true"/>
                        <CheckBox fx:id="checkUsageUnique" text="Usage unique par client"/>
                        <CheckBox fx:id="checkCumulable" text="Cumulable avec autres promotions"/>
                    </VBox>

                    <!-- Medicaments concernes -->
                    <VBox spacing="5">
                        <HBox alignment="CENTER_LEFT" spacing="10">
                            <Label text="Medicaments concernes:" styleClass="form-label"/>
                            <Label fx:id="lblNbMedicaments" text="(tous si vide)" styleClass="form-hint"/>
                        </HBox>
                        <HBox spacing="10">
                            <Button text="Selectionner..." onAction="#handleSelectMedicaments" styleClass="action-button">
                                <graphic><FontIcon iconLiteral="fas-pills"/></graphic>
                            </Button>
                            <Button text="Effacer" onAction="#handleClearMedicaments" styleClass="action-button">
                                <graphic><FontIcon iconLiteral="fas-times"/></graphic>
                            </Button>
                        </HBox>
                    </VBox>
                </VBox>
            </ScrollPane>

            <!-- Boutons d'action -->
            <HBox alignment="CENTER_RIGHT" spacing="10">
                <Button fx:id="btnAnnuler" text="Annuler" onAction="#handleAnnuler" styleClass="action-button">
                    <graphic><FontIcon iconLiteral="fas-times"/></graphic>
                </Button>
                <Button fx:id="btnSupprimer" text="Supprimer" onAction="#handleSupprimer"
                        styleClass="action-button, danger" disable="true">
                    <graphic><FontIcon iconLiteral="fas-trash"/></graphic>
                </Button>
                <Button fx:id="btnSauvegarder" text="Sauvegarder" onAction="#handleSauvegarder"
                        styleClass="action-button, primary">
                    <graphic><FontIcon iconLiteral="fas-save"/></graphic>
                </Button>
            </HBox>
        </VBox>
    </SplitPane>

</VBox>
