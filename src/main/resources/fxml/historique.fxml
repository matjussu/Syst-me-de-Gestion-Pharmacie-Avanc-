<?xml version="1.0" encoding="UTF-8"?>

<?import javafx.geometry.Insets?>
<?import javafx.scene.control.*?>
<?import javafx.scene.layout.*?>
<?import org.kordamp.ikonli.javafx.FontIcon?>

<VBox xmlns:fx="http://javafx.com/fxml/1"
      fx:controller="com.sgpa.controller.HistoriqueController"
      spacing="20" styleClass="view-root" maxWidth="Infinity" maxHeight="Infinity">
    <padding>
        <Insets top="20" right="20" bottom="20" left="20"/>
    </padding>

    <!-- Filtres -->
    <HBox spacing="12" alignment="CENTER_LEFT" styleClass="filters-bar">
        <HBox spacing="8" alignment="CENTER_LEFT">
            <Label text="Du :" styleClass="filter-label"/>
            <DatePicker fx:id="dateDebut" promptText="jj/mm/aaaa" prefWidth="140"/>
        </HBox>
        <HBox spacing="8" alignment="CENTER_LEFT">
            <Label text="Au :" styleClass="filter-label"/>
            <DatePicker fx:id="dateFin" promptText="jj/mm/aaaa" prefWidth="140"/>
        </HBox>
        <HBox spacing="5" alignment="CENTER_LEFT" styleClass="filter-buttons-group">
            <Button text="Filtrer" onAction="#handleFilter" styleClass="action-button, primary">
                <graphic><FontIcon iconLiteral="fas-filter"/></graphic>
            </Button>
            <Button text="Aujourd'hui" onAction="#handleToday" styleClass="action-button, filter-pill">
                <graphic><FontIcon iconLiteral="fas-calendar-day"/></graphic>
            </Button>
            <Button text="Cette semaine" onAction="#handleThisWeek" styleClass="action-button, filter-pill">
                <graphic><FontIcon iconLiteral="fas-calendar-week"/></graphic>
            </Button>
        </HBox>
        <Region HBox.hgrow="ALWAYS"/>
        <Label fx:id="lblTotal" text="Total: 0.00 EUR" styleClass="total-label"/>
    </HBox>

    <!-- Contenu principal : tableau + detail lateral -->
    <HBox fx:id="contentArea" spacing="16" VBox.vgrow="ALWAYS">

        <!-- Table des ventes -->
        <VBox HBox.hgrow="ALWAYS" styleClass="panel">
            <HBox alignment="CENTER_LEFT" spacing="10">
                <FontIcon iconLiteral="fas-history" styleClass="panel-icon"/>
                <Label text="Historique des Ventes" styleClass="panel-title"/>
                <Region HBox.hgrow="ALWAYS"/>
                <Label fx:id="lblCount" text="0 vente(s)" styleClass="count-label"/>
                <HBox fx:id="exportGroup" styleClass="export-group">
                    <Button text="PDF" onAction="#handleExportPDF" styleClass="export-pdf">
                        <graphic><FontIcon iconLiteral="fas-file-pdf"/></graphic>
                    </Button>
                    <Button text="CSV" onAction="#handleExportCSV" styleClass="export-csv">
                        <graphic><FontIcon iconLiteral="fas-file-csv"/></graphic>
                    </Button>
                    <Button text="Excel" onAction="#handleExportExcel" styleClass="export-excel">
                        <graphic><FontIcon iconLiteral="fas-file-excel"/></graphic>
                    </Button>
                </HBox>
            </HBox>

            <TableView fx:id="tableVentes" VBox.vgrow="ALWAYS" styleClass="data-table">
                <columns>
                    <TableColumn fx:id="colId" text="N&#176;" prefWidth="60"/>
                    <TableColumn fx:id="colDate" text="Date/Heure" prefWidth="150"/>
                    <TableColumn fx:id="colVendeur" text="Vendeur" prefWidth="150"/>
                    <TableColumn fx:id="colNbArticles" text="Articles" prefWidth="80"/>
                    <TableColumn fx:id="colMontant" text="Montant" prefWidth="100"/>
                    <TableColumn fx:id="colOrdonnance" text="Ordonnance" prefWidth="100"/>
                </columns>
                <placeholder>
                    <Label text="Aucune vente trouvee"/>
                </placeholder>
            </TableView>
        </VBox>

        <!-- Detail de la vente selectionnee (panneau lateral droit) -->
        <VBox fx:id="detailPane" styleClass="panel, detail-side-panel" visible="false" managed="false"
              prefWidth="400" minWidth="360" maxWidth="440">
            <HBox alignment="CENTER_LEFT" spacing="10">
                <FontIcon iconLiteral="fas-receipt" styleClass="panel-icon"/>
                <Label fx:id="lblDetailTitle" text="Detail de la vente N&#176;" styleClass="panel-title"/>
                <Region HBox.hgrow="ALWAYS"/>
                <Button text="Fermer" onAction="#handleCloseDetail" styleClass="action-button, danger-button">
                    <graphic><FontIcon iconLiteral="fas-times"/></graphic>
                </Button>
            </HBox>

            <TableView fx:id="tableDetail" VBox.vgrow="ALWAYS" styleClass="data-table">
                <columns>
                    <TableColumn fx:id="colDetailMedicament" text="Medicament" prefWidth="140"/>
                    <TableColumn fx:id="colDetailLot" text="N&#176; Lot" prefWidth="90"/>
                    <TableColumn fx:id="colDetailQuantite" text="Qte" prefWidth="50"/>
                    <TableColumn fx:id="colDetailPrixUnit" text="Prix Unit." prefWidth="80"/>
                    <TableColumn fx:id="colDetailTotal" text="Total" prefWidth="80"/>
                </columns>
            </TableView>

            <HBox alignment="CENTER" spacing="5" styleClass="fefo-info">
                <FontIcon iconLiteral="fas-info-circle" styleClass="info-icon"/>
                <Label text="Lots affiches selon l'ordre FEFO" styleClass="info-text" wrapText="true"/>
            </HBox>
        </VBox>

    </HBox>

</VBox>
